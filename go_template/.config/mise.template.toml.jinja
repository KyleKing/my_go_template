[tasks.bench]
description = "Run benchmarks"
run = "go test -bench=. -benchmem -run=^$ ./..."

{% if use_goreleaser -%}
[tasks."brew:sha"]
description = "Print SHA256 for Homebrew formula (run after release)"
run = """
echo "Download binaries from the latest release and run:"
echo "  shasum -a 256 {{ project_name }}-darwin-arm64 {{ project_name }}-darwin-amd64 {{ project_name }}-linux-arm64 {{ project_name }}-linux-amd64"
echo ""
echo "Then update Formula/{{ project_name }}.rb with the SHA256 values and version."
"""
{%- endif %}

{% if project_type == 'cli' -%}
[tasks.build]
description = "Build binary"
run = "go build -v -o {{ project_name }} ./cmd/{{ project_name }}"

[tasks.ci]
description = "Run all checks (used in GitHub Actions)"
run = ["go test -v -coverprofile=coverage.out ./...", "go build -v -o {{ project_name }} ./cmd/{{ project_name }}"]
{%- else %}
[tasks.build]
description = "Build packages"
run = "go build -v ./..."

[tasks.ci]
description = "Run all checks (used in GitHub Actions)"
run = ["go test -v -coverprofile=coverage.out ./...", "go build -v ./..."]
{%- endif %}

[tasks.clean]
description = "Clean build artifacts"
run = "rm -f coverage.out"

[tasks.demo]
description = "Generate VHS demo recordings"
run = 'find . -name "*.tape" -not -path "./.git/*" -exec vhs {} +'

[tasks.format]
description = "Format code with golangci-lint and golines"
run = ["golangci-lint run --fix ./...", "golines -w ."]

[tasks.hooks]
description = "Run git hooks"
run = "hk fix --quiet"

[tasks.lint]
description = "Run linter"
run = "golangci-lint run ./..."

[tasks.test]
description = "Run tests with coverage"
run = "go test -coverprofile=coverage.out ./..."

[tasks."test:view-coverage"]
description = "View coverage report in browser"
run = "go tool cover -html=coverage.out"
